/*
 * ROBOT.c
 *
 *  Created on: May 28, 2023
 *      Author: felipe
 */

#include "ROBOT.h"


void Mode_Change_Interrupt_Init() {
	GPIO_InitTypeDef gpioInit = {0};

	__HAL_RCC_GPIOC_CLK_ENABLE();

	gpioInit.Pin = MODE_CHANGE_Pin;
	gpioInit.Mode = GPIO_MODE_IT_RISING;
	gpioInit.Pull = GPIO_PULLDOWN;
	gpioInit.Speed = GPIO_SPEED_FREQ_LOW;

	HAL_GPIO_Init(MODE_CHANGE_Port, &gpioInit);

	//ENABLE INTERRUPT
	NVIC_SetPriority(EXTI15_10_IRQn, 5);

	NVIC_EnableIRQ(EXTI15_10_IRQn);
}


static float Joystick_To_Servo(int16_t val) {
    return (val + 45.0f) * 180.0f / 100.0f;
}


void Robot_Move(SG90_Struct_t* Robot[], int16_t* pos, uint32_t button) {
	float xy[2] = {-Joystick_To_Servo(pos[0]), Joystick_To_Servo(pos[1])};

	Servo_Rotate(Robot[0], xy[0]);
	Servo_Rotate(Robot[1], xy[1]);

	Servo_Rotate(Robot[2], button == 0 ? 0 : 180);
}


void Robot_Neutral(SG90_Struct_t* Robot[]) {
	Servo_Rotate(Robot[0], 90);
	Servo_Rotate(Robot[1], 90);

	Servo_Rotate(Robot[2], 0);
}

